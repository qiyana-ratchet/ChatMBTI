const e=document.querySelector(".screen");var t=document.querySelector(".banner"),n=document.querySelector(".ad-btm");const o=t.offsetHeight,i=n.offsetHeight,a=document.querySelector("body"),c=()=>{e.style.setProperty("--screen-height",a.offsetHeight-o-i+"px")};c(),a.classList.remove("hide-until-js-loaded"),window.addEventListener("resize",c),document.ondblclick=function(e){e.preventDefault()};t=document.querySelector(".quiz-start-btn");const u=document.querySelector(".chat-screen"),s=document.querySelector(".quiz-inform-screen");n=document.querySelector(".help-btn");const d=document.querySelector(".help-popup"),r={t:function(e,t,n=300,o=()=>{}){e.style.setProperty("--custom-duration",n+"ms"),t.style.setProperty("--custom-duration",n+"ms"),e.classList.add("fade-out"),setTimeout(()=>{e.classList.add("hidden"),e.classList.remove("fade-out"),t.classList.add("fade-in"),t.classList.remove("hidden"),o(),setTimeout(()=>{t.classList.remove("fade-in"),e.style.removeProperty("--custom-duration"),t.style.removeProperty("--custom-duration")},n)},n),c()},o:function(e,t,n=void 0){n&&e.style.setProperty("--custom-duration",n+"ms"),e.classList.remove(t),e.offsetWidth=e.offsetWidth,e.classList.add(t),e.classList.remove("hidden")},i:function(e,t,n=void 0){n&&e.style.setProperty("--custom-duration",n+"ms"),e.classList.remove(t),e.offsetWidth=e.offsetWidth,e.classList.add(t),e.classList.add("hidden")},u:function(e,t,n=500){e.style.setProperty("--custom-duration",n+"ms"),e.classList.remove("flip"),e.offsetWidth=e.offsetWidth,e.classList.add("flip"),setTimeout(()=>{e.childNodes[0].innerText=t},n/2),setTimeout(()=>{e.style.removeProperty("--custom-duration")},n)},p:function(e,t,n,o=1500,i=300,a="fade-in",c="fade-out"){const u=document.createElement("div");u.classList.add(t,a),u.style.setProperty("--custom-duration",i+"ms"),u.innerText=n,e.appendChild(u),setTimeout(()=>{u.classList.remove(a),u.classList.add(c),setTimeout(()=>{e.removeChild(u)},i)},o)}},p=(null!==n&&n.addEventListener("click",()=>{d.classList.contains("hidden")?r.o(d,"fade-in"):r.i(d,"fade-out")}),document.querySelector(".chat-interface")),l=document.querySelector(".chat-scrollbox"),m=document.querySelector(".mbti-buttons-chat"),f=document.querySelector(".ans-btn");document.querySelector(".quiz-ui");n=document.querySelector(".help-popup-mbti");const h=document.querySelector(".input-field-container"),b=document.querySelector(".input-field"),v=document.querySelector(".send-btn"),g=["안녕, 만나서 반가워!","너가 제일 좋아하는 색깔이 뭐야?","우리 동네에 있는 맛집 좀 추천해줘.","오늘 날씨 어때?","너 이번 주말에 뭐해?","지금 할 것 좀 추천해줘.","인공지능에 대해서 어떻게 생각해?","너가 가장 좋아하는 책이 뭐야?","심심한데 드립 하나만 쳐줘.","너는 심심할때 주로 뭐해?","인공지능의 지능과 사람의 지능 중에 어느 것이 더 높아?","인공지능이 자아를 가질 수 있다던데, 진짜야?","문의 개수와 바퀴의 개수 중 뭐가 더 많을까?","내가 지금 생각하고 있는 걸 맞춰봐.","인생은 공평해 불공평해?"],k=["mbti","성격","유형","엠비티아이","엠비티","비티아이"];const w=()=>{p.innerHTML="",z.length=0;var e=document.createElement("div");e.classList.add("blankspace"),e.style.setProperty("--blankspace-height",l.offsetHeight+"px"),p.appendChild(e),b.setAttribute("data-placeholder","안녕?")},T=(e,t)=>{var n=document.createElement("div");n.classList.add("chat-message"),n.classList.add(t?"user":"assistant"),t?((t=document.createElement("span")).classList.add("chat"),n.appendChild(t)):((t=document.createElement("img")).classList.add("profile-pic"),t.src="./assets/profile-icon.png",t.alt="profile pic",n.appendChild(t),(t=document.createElement("span")).classList.add("chat"),n.appendChild(t)),p.appendChild(n);{t=e;var o=document.querySelectorAll(".chat"),i;o[o.length-1].innerText=t}n=document.querySelector(".blankspace");"0px"!==n.style.getPropertyValue("--blankspace-height")&&(e=document.querySelectorAll(".chat-message"),(t=Array.from(e).reduce((e,t)=>e+t.offsetHeight+10,0))>l.offsetHeight?n.style.setProperty("--blankspace-height",0):n.style.setProperty("--blankspace-height",l.offsetHeight-t+"px")),l.scrollTop=l.scrollHeight};const S=()=>{var e=document.createElement("i");return e.classList.add("loading-icon","fas","fa-spinner","fa-spin"),p.appendChild(e),l.scrollTop=l.scrollHeight,e},y=()=>u.classList.contains("quiz");let z=[],x=sessionStorage.getItem("mbti");y()||(n.innerText=x.toUpperCase()),w(),b.focus(),v.onclick=async e=>{if(v.disabled)e.preventDefault();else if(v.disabled=!0,e.preventDefault(),b.focus(),""!==b.innerText&&""===b.innerText.trim()||70<b.innerText.length&&(r.p(h,"warning-popup","70자 이하로 입력해주세요!",1500),1))v.disabled=!1;else if(y()&&""===b.innerText|(()=>{const t=b.innerText.toLowerCase();var e=k.find(e=>t.includes(e));return!!e&&(r.p(h,"warning-popup","금지어 포함됨: "+e,1500),!0)})())v.disabled=!1;else{e=b.innerText,e=DOMPurify.sanitize(e),b.innerText="";e=e.trim();if(""===e)b.innerText=b.getAttribute("data-placeholder"),v.disabled=!1;else{b.setAttribute("data-placeholder",(t=Math.floor(Math.random()*g.length),g[t])),T(e,!0);var t=S();try{var n=await K.l(e,z,x),o=(p.removeChild(t),T(n,!1),e),i=n;z.push({role:"user",content:o}),z.push({role:"assistant",content:i}),8<z.length&&(o=z.slice(-8),(i=z.slice(0,-8)).pop(),z=i.concat(o)),v.disabled=!1}catch{r.p(h,"warning-popup","ChatGPT가 아파요 ㅠㅠ 다시 시도해주세요",1500),p.removeChild(t),v.disabled=!1}}}},b.onkeydown=e=>{"Enter"!==e.key&&13!==e.keyCode||e.shiftKey||(e.preventDefault(),e.isComposing)||v.click()},b.addEventListener("keypress",e=>{e.stopPropagation(),"Enter"!==e.key&&13!==e.keyCode||e.shiftKey||v.click()});const P=document.querySelectorAll(".mbti-btn-chat"),q=document.querySelector(".result-popup");n=document.querySelectorAll(".regame-btn");const E=document.querySelectorAll(".result-container"),M=document.querySelector(".correct-result-container"),C=document.querySelector(".wrong-result-container"),N=document.querySelector(".ans-value"),A=document.querySelector(".tries-value"),B=document.querySelector(".win-streak-value"),D=document.querySelector(".highest-score-value");var G=document.querySelectorAll(".see-chat-btn");const H=()=>{b.focus()};t.addEventListener("click",()=>{r.t(s,u,300,H)});for(let e=0;e<P.length;e++)P[e].addEventListener("click",()=>{P[e].classList.toggle("flipped"),P[e].classList.remove("flip"),P[e].offsetWidth=P[e].offsetWidth,P[e].classList.add("flip")});const j=[{m:"I",h:"E"},{m:"S",h:"N"},{m:"T",h:"F"},{m:"J",h:"P"}];for(let e=0;e<P.length;e++)P[e].addEventListener("click",()=>{P[e].classList.remove("default"),P[e].classList.contains("flipped")?setTimeout(()=>{P[e].children[0].innerText=j[e].h},250):setTimeout(()=>{P[e].children[0].innerText=j[e].m},250)});E.forEach(e=>{e.addEventListener("click",()=>{q.classList.contains("result-popup-up")&&(q.style.transition="0s",q.style.top="0",q.style.height="100%",setTimeout(()=>{q.style.transition="0.5s",q.classList.remove("result-popup-up")},0))})});for(let e=0;e<2;e++)G[e].addEventListener("click",e=>{e.stopPropagation(),E.forEach(e=>{e.style.setProperty("--screen-height",a.offsetHeight+"px")}),q.classList.add("result-popup-up"),setTimeout(()=>{q.style.top="50%",q.style.height="0"},500)});let I=["?","?","?","?"],O,F=sessionStorage.getItem("winStreak");const J=()=>{w();var e=(()=>{const e=Math.floor(Math.random()*16);return O=e})();sessionStorage.setItem("mbti",e),x=e;for(let e=0;e<m.children.length;e++)m.children[e].classList.add("default");I=["?","?","?","?"];for(let e=0;e<P.length;e++)P[e].children[0].innerText="?";for(let e=0;e<P.length;e++)P[e].classList.add("flipped")},R=e=>{A.innerText=p.querySelectorAll(".user").length,B.innerText=e,M.classList.remove("hidden"),C.classList.add("hidden"),r.o(q,"fade-in",700)},U=e=>{N.innerText=(()=>{const t=[],n=O.toString(2).padStart(4,"0");for(let e=0;e<4;e++)if(n[e]==="0")t.push(j[e].m);else t.push(j[e].h);return t.join("")})(),D.innerText=e,M.classList.add("hidden"),C.classList.remove("hidden"),r.o(q,"fade-in",700)},K=(t.addEventListener("click",()=>{J()}),f.addEventListener("click",()=>{f.disabled=!0;for(let e=0;e<4;e++)P[e].classList.contains("default")||(P[e].classList.contains("flipped")?I[e]=1:I[e]=0);var e;(()=>{for(let e=0;e<4;e++)if(P[e].classList.contains("default"))return!0})()?(alert("모든 문항을 선택해주세요!"),f.disabled=!1):parseInt(I.join(""),2)===O?(void 0===F&&(F=0,sessionStorage.setItem("winStreak",F)),F++,sessionStorage.setItem("winStreak",F),R(F)):(e=void 0===F?0:F,F=0,sessionStorage.setItem("winStreak",F),U(e))}),n.forEach(e=>{e.addEventListener("click",e=>{q.classList.contains("result-popup-up")||(r.i(q,"fade-out",700),f.disabled=!1,J())})}),{l:async function(e,t,n){e=await(await fetch("https://3pba7ji2tzwavco7qbpmvvpmbm0ztzxs.lambda-url.ap-northeast-2.on.aws/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInput:e,chatHistory:t,mbtiRaw:n})})).json();if(e.error)throw new Error("Error in api.postChat");return e.content}});