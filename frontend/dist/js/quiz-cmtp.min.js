const e=document.querySelector(".screen");var t=document.querySelector(".banner"),n=document.querySelector(".ad-btm");const o=t.offsetHeight,i=n.offsetHeight,a=document.querySelector("body"),c=()=>{e.style.setProperty("--screen-height",a.offsetHeight-o-i+"px")};c(),window.addEventListener("resize",c),document.ondblclick=function(e){e.preventDefault()};t=document.querySelector(".quiz-start-btn");const u=document.querySelector(".chat-screen"),s=document.querySelector(".quiz-inform-screen");n=document.querySelector(".help-btn");const r=document.querySelector(".help-popup"),d={t:function(e,t,n=300,o=()=>{}){e.style.setProperty("--custom-duration",n+"ms"),t.style.setProperty("--custom-duration",n+"ms"),e.classList.add("fade-out"),setTimeout(()=>{e.classList.add("hidden"),e.classList.remove("fade-out"),t.classList.add("fade-in"),t.classList.remove("hidden"),o(),setTimeout(()=>{t.classList.remove("fade-in"),e.style.removeProperty("--custom-duration"),t.style.removeProperty("--custom-duration")},n)},n),c()},o:function(e,t,n=void 0){n&&e.style.setProperty("--custom-duration",n+"ms"),e.classList.remove(t),e.offsetWidth=e.offsetWidth,e.classList.add(t),e.classList.remove("hidden")},i:function(e,t,n=void 0){n&&e.style.setProperty("--custom-duration",n+"ms"),e.classList.remove(t),e.offsetWidth=e.offsetWidth,e.classList.add(t),e.classList.add("hidden")},u:function(e,t,n=500){e.style.setProperty("--custom-duration",n+"ms"),e.classList.remove("flip"),e.offsetWidth=e.offsetWidth,e.classList.add("flip"),setTimeout(()=>{e.childNodes[0].innerText=t},n/2),setTimeout(()=>{e.style.removeProperty("--custom-duration")},n)},p:function(e,t,n,o=1500,i=300,a="fade-in",c="fade-out"){const u=document.createElement("div");u.classList.add(t,a),u.style.setProperty("--custom-duration",i+"ms"),u.innerText=n,e.appendChild(u),setTimeout(()=>{u.classList.remove(a),u.classList.add(c),setTimeout(()=>{e.removeChild(u)},i)},o)}},p=(n.addEventListener("click",()=>{r.classList.contains("hidden")?d.o(r,"fade-in"):d.i(r,"fade-out")}),document.querySelector(".chat-interface")),l=document.querySelector(".chat-scrollbox"),m=document.querySelector(".mbti-buttons-chat");var n=document.querySelector(".ans-btn"),f=(document.querySelector(".quiz-ui"),document.querySelector(".help-popup-mbti"));const h=document.querySelector(".input-field-container"),b=document.querySelector(".input-field"),g=document.querySelector(".send-btn"),k=()=>{p.innerHTML="",x.length=0;var e=document.createElement("div");e.classList.add("blankspace"),e.style.setProperty("--blankspace-height",l.offsetHeight+"px"),p.appendChild(e),b.setAttribute("data-placeholder","안녕?")},v=(e,t)=>{var n=document.createElement("div");n.classList.add("chat-message"),n.classList.add(t?"user":"assistant"),t?((t=document.createElement("span")).classList.add("chat"),n.appendChild(t)):((t=document.createElement("img")).classList.add("profile-pic"),t.src="./assets/profile-icon.png",t.alt="profile pic",n.appendChild(t),(t=document.createElement("span")).classList.add("chat"),n.appendChild(t)),p.appendChild(n);{t=e;var o=document.querySelectorAll(".chat"),i;o[o.length-1].innerText=t}n=document.querySelector(".blankspace");"0px"!==n.style.getPropertyValue("--blankspace-height")&&(e=document.querySelectorAll(".chat-message"),(t=Array.from(e).reduce((e,t)=>e+t.offsetHeight+10,0))>l.offsetHeight?n.style.setProperty("--blankspace-height",0):n.style.setProperty("--blankspace-height",l.offsetHeight-t+"px")),l.scrollTop=l.scrollHeight};const w=()=>{var e=document.createElement("i");return e.classList.add("loading-icon","fas","fa-spinner","fa-spin"),p.appendChild(e),l.scrollTop=l.scrollHeight,e},T=()=>u.classList.contains("quiz"),S=["안녕, 만나서 반가워!","너가 제일 좋아하는 색깔이 뭐야?","우리 동네에 있는 맛집 좀 추천해줘.","오늘 날씨 어때?","너 이번 주말에 뭐해?","지금 할 것 좀 추천해줘.","인간이 느끼는 감정이란 뭘까?","인공지능에 대해서 어떻게 생각해?","너가 가장 좋아하는 책이 뭐야?","심심한데 드립 하나만 쳐줘.","너는 심심할때 주로 뭐해?","인공지능의 지능과 사람의 지능 중에 어느 것이 더 높아?","인공지능이 자아를 가질 수 있다던데, 진짜야?","뉴욕에 있는 창문의 개수를 다 세면 대략 몇개일까?","문의 개수와 바퀴의 개수 중 뭐가 더 많을까?","지구가 둥근 걸 증명해봐.","내가 지금 생각하고 있는 걸 맞춰봐.","인생은 공평해 불공평해?"],y=["mbti","성격","유형"];const x=[];let P=sessionStorage.getItem("mbti");T()||(f.innerText=P.toUpperCase()),k(),b.focus(),g.addEventListener("click",async e=>{if(e.preventDefault(),b.focus(),!(""!==b.innerText&&""===b.innerText.trim()||(70<b.innerText.length?(d.p(h,"warning-popup","70자 이하로 입력해주세요!",1500),1):T()&&""===b.innerText|(()=>{const t=b.innerText.toLowerCase();var e=y.find(e=>t.includes(e));return!!e&&(d.p(h,"warning-popup","금지어 포함됨: "+e,1500),!0)})()))){e=b.innerText,e=DOMPurify.sanitize(e),b.innerText="";e=e.trim();if(""===e)b.innerText=b.getAttribute("data-placeholder");else{b.setAttribute("data-placeholder",(o=Math.floor(Math.random()*S.length),S[o])),v(e,!0);var t,n,o=w();g.disabled=!0;try{var i=await K.l(e,x,P);p.removeChild(o),v(i,!1),t=e,n=i,x.push({role:"user",content:t}),x.push({role:"assistant",content:n}),g.disabled=!1}catch{d.p(h,"warning-popup","ChatGPT가 아파요 ㅠㅠ 다시 시도해주세요",1500),p.removeChild(o),g.disabled=!1}}}}),b.onkeydown=e=>{"Enter"!==e.key&&13!==e.keyCode||e.shiftKey||(e.preventDefault(),e.isComposing)||g.click()},b.addEventListener("keypress",e=>{"Enter"!==e.key&&13!==e.keyCode||e.shiftKey||g.click()});const z=document.querySelectorAll(".mbti-btn-chat"),E=document.querySelector(".result-popup");f=document.querySelectorAll(".regame-btn");const M=document.querySelectorAll(".result-container"),q=document.querySelector(".correct-result-container"),C=document.querySelector(".wrong-result-container"),j=document.querySelector(".ans-value"),A=document.querySelector(".tries-value"),B=document.querySelector(".win-streak-value"),D=document.querySelector(".highest-score-value");var G=document.querySelectorAll(".see-chat-btn");const H=()=>{b.focus()};t.addEventListener("click",()=>{d.t(s,u,300,H)});for(let e=0;e<z.length;e++)z[e].addEventListener("click",()=>{z[e].classList.toggle("flipped"),z[e].classList.remove("flip"),z[e].offsetWidth=z[e].offsetWidth,z[e].classList.add("flip")});const I=[{m:"I",h:"E"},{m:"S",h:"N"},{m:"T",h:"F"},{m:"J",h:"P"}];for(let e=0;e<z.length;e++)z[e].addEventListener("click",()=>{z[e].classList.remove("default"),z[e].classList.contains("flipped")?setTimeout(()=>{z[e].children[0].innerText=I[e].h},250):setTimeout(()=>{z[e].children[0].innerText=I[e].m},250)});M.forEach(e=>{e.addEventListener("click",()=>{E.classList.contains("result-popup-up")&&(E.style.transition="0s",E.style.top="0",E.style.height="100%",setTimeout(()=>{E.style.transition="0.5s",E.classList.remove("result-popup-up")},0))})});for(let e=0;e<2;e++)G[e].addEventListener("click",e=>{e.stopPropagation(),M.forEach(e=>{e.style.setProperty("--screen-height",a.offsetHeight+"px")}),E.classList.add("result-popup-up"),setTimeout(()=>{E.style.top="50%",E.style.height="0"},500)});let O=["?","?","?","?"],F,J=sessionStorage.getItem("winStreak");const N=()=>{k();var e=(()=>{const e=Math.floor(Math.random()*16);return F=e})();sessionStorage.setItem("mbti",e),P=e;for(let e=0;e<m.children.length;e++)m.children[e].classList.add("default");O=["?","?","?","?"];for(let e=0;e<z.length;e++)z[e].children[0].innerText="?";for(let e=0;e<z.length;e++)z[e].classList.add("flipped")},R=e=>{A.innerText=p.querySelectorAll(".user").length,B.innerText=e,q.classList.remove("hidden"),C.classList.add("hidden"),d.o(E,"fade-in",700)},U=e=>{j.innerText=(()=>{const t=[],n=F.toString(2).padStart(4,"0");for(let e=0;e<4;e++)if(n[e]==="0")t.push(I[e].m);else t.push(I[e].h);return t.join("")})(),D.innerText=e,q.classList.add("hidden"),C.classList.remove("hidden"),d.o(E,"fade-in",700)},K=(t.addEventListener("click",()=>{N()}),n.addEventListener("click",()=>{for(let e=0;e<4;e++)z[e].classList.contains("default")||(z[e].classList.contains("flipped")?O[e]=1:O[e]=0);var e;(()=>{for(let e=0;e<4;e++)if(z[e].classList.contains("default"))return!0})()?alert("모든 문항을 선택해주세요!"):parseInt(O.join(""),2)===F?(void 0===J&&(J=0,sessionStorage.setItem("winStreak",J)),J++,sessionStorage.setItem("winStreak",J),R(J)):(e=void 0===J?0:J,J=0,sessionStorage.setItem("winStreak",J),U(e))}),f.forEach(e=>{e.addEventListener("click",e=>{E.classList.contains("result-popup-up")||(d.i(E,"fade-out",700),N())})}),{l:async function(e,t,n){e=await(await fetch("https://a69nkirgb3.execute-api.ap-northeast-2.amazonaws.com/prod/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInput:e,chatHistory:t,mbtiRaw:n})})).json();if(e.error)throw console.log("hello"),new Error("Error in api.postChat");return e.content}});