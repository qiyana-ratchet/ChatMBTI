const t=document.querySelector(".screen");var e=document.querySelector(".banner"),n=document.querySelector(".ad-btm");const o=e.offsetHeight,i=n.offsetHeight,c=document.querySelector("body"),a=()=>{t.style.setProperty("--screen-height",c.offsetHeight-o-i+"px")};a(),window.addEventListener("resize",a),document.ondblclick=function(t){t.preventDefault()};e=document.querySelector(".quiz-start-btn");const u=document.querySelector(".chat-screen"),s=document.querySelector(".quiz-inform-screen");n=document.querySelector(".help-btn");const d=document.querySelector(".help-popup"),r={t:function(t,e,n=300,o=()=>{}){t.style.setProperty("--custom-duration",n+"ms"),e.style.setProperty("--custom-duration",n+"ms"),t.classList.add("fade-out"),setTimeout(()=>{t.classList.add("hidden"),t.classList.remove("fade-out"),e.classList.add("fade-in"),e.classList.remove("hidden"),o(),setTimeout(()=>{e.classList.remove("fade-in"),t.style.removeProperty("--custom-duration"),e.style.removeProperty("--custom-duration")},n)},n),a()},o:function(t,e,n=void 0){n&&t.style.setProperty("--custom-duration",n+"ms"),t.classList.remove(e),t.offsetWidth=t.offsetWidth,t.classList.add(e),t.classList.remove("hidden")},i:function(t,e,n=void 0){n&&t.style.setProperty("--custom-duration",n+"ms"),t.classList.remove(e),t.offsetWidth=t.offsetWidth,t.classList.add(e),t.classList.add("hidden")},u:function(t,e,n=500){t.style.setProperty("--custom-duration",n+"ms"),t.classList.remove("flip"),t.offsetWidth=t.offsetWidth,t.classList.add("flip"),setTimeout(()=>{t.childNodes[0].innerText=e},n/2),setTimeout(()=>{t.style.removeProperty("--custom-duration")},n)},p:function(t,e,n,o=1500,i=300,c="fade-in",a="fade-out"){const u=document.createElement("div");u.classList.add(e,c),u.style.setProperty("--custom-duration",i+"ms"),u.innerText=n,t.appendChild(u),setTimeout(()=>{u.classList.remove(c),u.classList.add(a),setTimeout(()=>{t.removeChild(u)},i)},o)}},p=(n.addEventListener("click",()=>{d.classList.contains("hidden")?r.o(d,"fade-in"):r.i(d,"fade-out")}),document.querySelector(".chat-interface")),l=document.querySelector(".chat-scrollbox"),m=document.querySelector(".mbti-buttons-chat");var n=document.querySelector(".ans-btn"),f=(document.querySelector(".quiz-ui"),document.querySelector(".help-popup-mbti"));const h=document.querySelector(".input-field-container"),b=document.querySelector(".input-field"),g=document.querySelector(".send-btn"),v=()=>{p.innerHTML="",P.length=0;var t=document.createElement("div");t.classList.add("blankspace"),t.style.setProperty("--blankspace-height",l.offsetHeight+"px"),p.appendChild(t),b.setAttribute("data-placeholder","안녕?")},k=(t,e)=>{var n=document.createElement("div");n.classList.add("chat-message"),n.classList.add(e?"user":"assistant"),e?((e=document.createElement("span")).classList.add("chat"),n.appendChild(e)):((e=document.createElement("img")).classList.add("profile-pic"),e.src="./assets/profile-icon.png",e.alt="profile pic",n.appendChild(e),(e=document.createElement("span")).classList.add("chat"),n.appendChild(e)),p.appendChild(n);{e=t;var o=document.querySelectorAll(".chat"),i;o[o.length-1].innerText=e}n=document.querySelector(".blankspace");"0px"!==n.style.getPropertyValue("--blankspace-height")&&(t=document.querySelectorAll(".chat-message"),(e=Array.from(t).reduce((t,e)=>t+e.offsetHeight+10,0))>l.offsetHeight?n.style.setProperty("--blankspace-height",0):n.style.setProperty("--blankspace-height",l.offsetHeight-e+"px")),l.scrollTop=l.scrollHeight};const w=()=>{var t=document.createElement("i");return t.classList.add("loading-icon","fas","fa-spinner","fa-spin"),p.appendChild(t),l.scrollTop=l.scrollHeight,t},T=()=>u.classList.contains("quiz"),S=["안녕, 만나서 반가워!","너가 제일 좋아하는 색깔이 뭐야?","우리 동네에 있는 맛집 좀 추천해줘.","오늘 날씨 어때?","너 이번 주말에 뭐해?","지금 할 것 좀 추천해줘.","인간이 느끼는 감정이란 뭘까?","인공지능에 대해서 어떻게 생각해?","너가 가장 좋아하는 책이 뭐야?","심심한데 드립 하나만 쳐줘.","너는 심심할때 주로 뭐해?","인공지능의 지능과 사람의 지능 중에 어느 것이 더 높아?","인공지능이 자아를 가질 수 있다던데, 진짜야?","뉴욕에 있는 창문의 개수를 다 세면 대략 몇개일까?","문의 개수와 바퀴의 개수 중 뭐가 더 많을까?","지구가 둥근 걸 증명해봐.","내가 지금 생각하고 있는 걸 맞춰봐.","인생은 공평해 불공평해?"],y=["mbti","성격","유형"];const P=[];let x=sessionStorage.getItem("mbti");T()||(f.innerText=x.toUpperCase()),v(),b.focus(),g.addEventListener("click",async t=>{if(t.preventDefault(),b.focus(),!(""!==b.innerText&&""===b.innerText.trim()||(70<b.innerText.length?(r.p(h,"warning-popup","70자 이하로 입력해주세요!",1500),1):T()&&""===b.innerText|(()=>{const e=b.innerText.toLowerCase();var t=y.find(t=>e.includes(t));return!!t&&(r.p(h,"warning-popup","금지어 포함됨: "+t,1500),!0)})()))){t=b.innerText,t=DOMPurify.sanitize(t),b.innerText="";t=t.trim();if(""===t)b.innerText=b.getAttribute("data-placeholder");else{b.setAttribute("data-placeholder",(o=Math.floor(Math.random()*S.length),S[o])),k(t,!0);var e,n,o=w();g.disabled=!0;try{var i=await K.l(t,P,x);p.removeChild(o),k(i,!1),e=t,n=i,P.push({role:"user",content:e}),P.push({role:"assistant",content:n}),g.disabled=!1}catch{r.p(h,"warning-popup","ChatGPT가 아파요 ㅠㅠ 다시 시도해주세요",1500),p.removeChild(o),g.disabled=!1}}}}),b.onkeydown=t=>{"Enter"!==t.key&&13!==t.keyCode||t.shiftKey||(t.preventDefault(),t.isComposing)||g.click()},b.addEventListener("keypress",t=>{"Enter"!==t.key&&13!==t.keyCode||t.shiftKey||g.click()});const z=document.querySelectorAll(".mbti-btn-chat"),E=document.querySelector(".result-popup");f=document.querySelectorAll(".regame-btn");const M=document.querySelectorAll(".result-container"),q=document.querySelector(".correct-result-container"),C=document.querySelector(".wrong-result-container"),j=document.querySelector(".ans-value"),A=document.querySelector(".tries-value"),B=document.querySelector(".win-streak-value"),D=document.querySelector(".highest-score-value");var G=document.querySelectorAll(".see-chat-btn");const H=()=>{b.focus()};e.addEventListener("click",()=>{r.t(s,u,300,H)});for(let t=0;t<z.length;t++)z[t].addEventListener("click",()=>{z[t].classList.toggle("flipped"),z[t].classList.remove("flip"),z[t].offsetWidth=z[t].offsetWidth,z[t].classList.add("flip")});const I=[{m:"I",h:"E"},{m:"S",h:"N"},{m:"T",h:"F"},{m:"J",h:"P"}];for(let t=0;t<z.length;t++)z[t].addEventListener("click",()=>{z[t].classList.remove("default"),z[t].classList.contains("flipped")?setTimeout(()=>{z[t].children[0].innerText=I[t].h},250):setTimeout(()=>{z[t].children[0].innerText=I[t].m},250)});M.forEach(t=>{t.addEventListener("click",()=>{E.classList.contains("result-popup-up")&&(E.style.transition="0s",E.style.top="0",E.style.height="100%",setTimeout(()=>{E.style.transition="0.5s",E.classList.remove("result-popup-up")},0))})});for(let t=0;t<2;t++)G[t].addEventListener("click",t=>{t.stopPropagation(),M.forEach(t=>{t.style.setProperty("--screen-height",c.offsetHeight+"px")}),E.classList.add("result-popup-up"),setTimeout(()=>{E.style.top="50%",E.style.height="0"},500)});let O=["?","?","?","?"],F,J=sessionStorage.getItem("winStreak");const N=()=>{v();var t=(()=>{const t=Math.floor(Math.random()*16);return F=t})();sessionStorage.setItem("mbti",t),x=t;for(let t=0;t<m.children.length;t++)m.children[t].classList.add("default");O=["?","?","?","?"];for(let t=0;t<z.length;t++)z[t].children[0].innerText="?";for(let t=0;t<z.length;t++)z[t].classList.add("flipped")},R=t=>{A.innerText=p.querySelectorAll(".user").length,B.innerText=t,q.classList.remove("hidden"),C.classList.add("hidden"),r.o(E,"fade-in",700)},U=t=>{j.innerText=(()=>{const e=[],n=F.toString(2).padStart(4,"0");for(let t=0;t<4;t++)if(n[t]==="0")e.push(I[t].m);else e.push(I[t].h);return e.join("")})(),D.innerText=t,q.classList.add("hidden"),C.classList.remove("hidden"),r.o(E,"fade-in",700)},K=(e.addEventListener("click",()=>{N()}),n.addEventListener("click",()=>{for(let t=0;t<4;t++)z[t].classList.contains("default")||(z[t].classList.contains("flipped")?O[t]=1:O[t]=0);var t;(()=>{for(let t=0;t<4;t++)if(z[t].classList.contains("default"))return!0})()?alert("모든 문항을 선택해주세요!"):parseInt(O.join(""),2)===F?(void 0===J&&(J=0,sessionStorage.setItem("winStreak",J)),J++,sessionStorage.setItem("winStreak",J),R(J)):(t=void 0===J?0:J,J=0,sessionStorage.setItem("winStreak",J),U(t))}),f.forEach(t=>{t.addEventListener("click",t=>{E.classList.contains("result-popup-up")||(r.i(E,"fade-out",700),N())})}),{l:async function(t,e,n){t=await(await fetch("http://localhost:4000/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInput:t,chatHistory:e,mbtiRaw:n})})).json();if(t.error)throw console.log("hello"),new Error("Error in api.postChat");return t.content}});