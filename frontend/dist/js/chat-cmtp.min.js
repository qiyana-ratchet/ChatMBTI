const t=document.querySelector(".screen");var n=document.querySelector(".banner"),e=document.querySelector(".ad-btm");const o=n.offsetHeight,a=e.offsetHeight,i=document.querySelector("body"),c=()=>{t.style.setProperty("--screen-height",i.offsetHeight-o-a+"px")};c(),window.addEventListener("resize",c),document.ondblclick=function(t){t.preventDefault()};document.querySelector(".quiz-start-btn");const s=document.querySelector(".chat-screen");document.querySelector(".quiz-inform-screen");n=document.querySelector(".help-btn");const u=document.querySelector(".help-popup"),d={t:function(t,n,e=300,o=()=>{}){t.style.setProperty("--custom-duration",e+"ms"),n.style.setProperty("--custom-duration",e+"ms"),t.classList.add("fade-out"),setTimeout(()=>{t.classList.add("hidden"),t.classList.remove("fade-out"),n.classList.add("fade-in"),n.classList.remove("hidden"),o(),setTimeout(()=>{n.classList.remove("fade-in"),t.style.removeProperty("--custom-duration"),n.style.removeProperty("--custom-duration")},e)},e),c()},o:function(t,n,e=void 0){e&&t.style.setProperty("--custom-duration",e+"ms"),t.classList.remove(n),t.offsetWidth=t.offsetWidth,t.classList.add(n),t.classList.remove("hidden")},i:function(t,n,e=void 0){e&&t.style.setProperty("--custom-duration",e+"ms"),t.classList.remove(n),t.offsetWidth=t.offsetWidth,t.classList.add(n),t.classList.add("hidden")},u:function(t,n,e=500){t.style.setProperty("--custom-duration",e+"ms"),t.classList.remove("flip"),t.offsetWidth=t.offsetWidth,t.classList.add("flip"),setTimeout(()=>{t.childNodes[0].innerText=n},e/2),setTimeout(()=>{t.style.removeProperty("--custom-duration")},e)},p:function(t,n,e,o=1500,a=300,i="fade-in",c="fade-out"){const s=document.createElement("div");s.classList.add(n,i),s.style.setProperty("--custom-duration",a+"ms"),s.innerText=e,t.appendChild(s),setTimeout(()=>{s.classList.remove(i),s.classList.add(c),setTimeout(()=>{t.removeChild(s)},a)},o)}},r=(n.addEventListener("click",()=>{u.classList.contains("hidden")?d.o(u,"fade-in"):d.i(u,"fade-out")}),document.querySelector(".chat-interface")),p=document.querySelector(".chat-scrollbox");document.querySelector(".mbti-buttons-chat"),document.querySelector(".ans-btn"),document.querySelector(".quiz-ui");e=document.querySelector(".help-popup-mbti");const m=document.querySelector(".input-field-container"),h=document.querySelector(".input-field"),l=document.querySelector(".send-btn");const f=(t,n)=>{var e=document.createElement("div");e.classList.add("chat-message"),e.classList.add(n?"user":"assistant"),n?((n=document.createElement("span")).classList.add("chat"),e.appendChild(n)):((n=document.createElement("img")).classList.add("profile-pic"),n.src="./assets/profile-icon.png",n.alt="profile pic",e.appendChild(n),(n=document.createElement("span")).classList.add("chat"),e.appendChild(n)),r.appendChild(e);{n=t;var o=document.querySelectorAll(".chat"),a;o[o.length-1].innerText=n}e=document.querySelector(".blankspace");"0px"!==e.style.getPropertyValue("--blankspace-height")&&(t=document.querySelectorAll(".chat-message"),(n=Array.from(t).reduce((t,n)=>t+n.offsetHeight+10,0))>p.offsetHeight?e.style.setProperty("--blankspace-height",0):e.style.setProperty("--blankspace-height",p.offsetHeight-n+"px")),p.scrollTop=p.scrollHeight};const b=()=>{var t=document.createElement("i");return t.classList.add("loading-icon","fas","fa-spinner","fa-spin"),r.appendChild(t),p.scrollTop=p.scrollHeight,t},v=()=>s.classList.contains("quiz"),g=["안녕, 만나서 반가워!","너가 제일 좋아하는 색깔이 뭐야?","우리 동네에 있는 맛집 좀 추천해줘.","오늘 날씨 어때?","너 이번 주말에 뭐해?","지금 할 것 좀 추천해줘.","인공지능에 대해서 어떻게 생각해?","너가 가장 좋아하는 책이 뭐야?","심심한데 드립 하나만 쳐줘.","너는 심심할때 주로 뭐해?","인공지능의 지능과 사람의 지능 중에 어느 것이 더 높아?","인공지능이 자아를 가질 수 있다던데, 진짜야?","문의 개수와 바퀴의 개수 중 뭐가 더 많을까?","내가 지금 생각하고 있는 걸 맞춰봐.","인생은 공평해 불공평해?"],w=["mbti","성격","유형"];let y=[],T=sessionStorage.getItem("mbti");v()||(e.innerText=T.toUpperCase()),r.innerHTML="",y.length=0,(n=document.createElement("div")).classList.add("blankspace"),n.style.setProperty("--blankspace-height",p.offsetHeight+"px"),r.appendChild(n),h.setAttribute("data-placeholder","안녕?"),h.focus(),l.onclick=async t=>{if(l.disabled)t.preventDefault();else if(l.disabled=!0,t.preventDefault(),h.focus(),""!==h.innerText&&""===h.innerText.trim()||70<h.innerText.length&&(d.p(m,"warning-popup","70자 이하로 입력해주세요!",1500),1))l.disabled=!1;else if(v()&&""===h.innerText|(()=>{const n=h.innerText.toLowerCase();var t=w.find(t=>n.includes(t));return!!t&&(d.p(m,"warning-popup","금지어 포함됨: "+t,1500),!0)})())l.disabled=!1;else{t=h.innerText,t=DOMPurify.sanitize(t),h.innerText="";t=t.trim();if(""===t)h.innerText=h.getAttribute("data-placeholder"),l.disabled=!1;else{h.setAttribute("data-placeholder",(n=Math.floor(Math.random()*g.length),g[n])),f(t,!0);var n=b();try{var e=await k.m(t,y,T),o=(r.removeChild(n),f(e,!1),t),a=e;y.push({role:"user",content:o}),y.push({role:"assistant",content:a}),8<y.length&&(o=y.slice(-8),(a=y.slice(0,-8)).pop(),y=a.concat(o)),console.log(y),l.disabled=!1}catch{d.p(m,"warning-popup","ChatGPT가 아파요 ㅠㅠ 다시 시도해주세요",1500),r.removeChild(n),l.disabled=!1}}}},h.onkeydown=t=>{"Enter"!==t.key&&13!==t.keyCode||t.shiftKey||(t.preventDefault(),t.isComposing)||l.click()},h.addEventListener("keypress",t=>{t.stopPropagation(),"Enter"!==t.key&&13!==t.keyCode||t.shiftKey||l.click()});const k={m:async function(t,n,e){t=await(await fetch("https://3pba7ji2tzwavco7qbpmvvpmbm0ztzxs.lambda-url.ap-northeast-2.on.aws/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInput:t,chatHistory:n,mbtiRaw:e})})).json();if(t.error)throw console.log("hello"),new Error("Error in api.postChat");return t.content}};